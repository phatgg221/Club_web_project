(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{1585:function(t,e,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/tips/form",function(){return a(968)}])},968:function(t,e,a){"use strict";a.r(e);var n=a(5893),o=a(7294),i=a(1163),r=a(7148),s=a.n(r),l=a(1993),c=a.n(l),p=a(4436);let m=()=>{let t=(0,i.useRouter)(),{isAdmin:e}=(0,p.a)(),{id:a}=t.query,[r,l]=(0,o.useState)(1),[m,d]=(0,o.useState)([{name:"",contents:"",tipImage:""}]),[u,_]=(0,o.useState)(!1),[h,b]=(0,o.useState)({tipName:"",tipsLink:"",realContent:[]}),[f,g]=(0,o.useState)(""),[j,x]=(0,o.useState)("");(0,o.useEffect)(()=>{b(t=>({...t,realContent:m}))},[m]),(0,o.useEffect)(()=>{(async()=>{if(a)try{_(!0);let t=await fetch("/api/tip_api?id=".concat(a)),e=await t.json();e&&!1===e.error&&200===e.statusCode&&e.data&&e.data.sampleData&&e.data.sampleData.data?(b(e.data.sampleData.data),l(e.data.sampleData.data.realContent.length),d(e.data.sampleData.data.realContent)):console.error("Data structure is not as expected: ",e)}catch(t){console.error("Error fetching data: ",t)}})()},[a]);let C=(t,e)=>{let a=[...m];a[t][e.target.name]=e.target.value,d(a)},w=(t,e)=>{let a=[...h.realContent];a[t][e.target.name]=e.target.value,b(t=>({...t,realContent:a}))},N=t=>{let e=[...m];e.splice(t,1),d(e)},v=async t=>{if(t.preventDefault(),j){alert("Invalid form. Cannot submit.");return}try{let t={...h},e=await Promise.all(t.realContent.map(async(t,e)=>{let a=new FormData,n=document.getElementById("Image-".concat(e));if(n&&n.files.length>0){a.append("file",n.files[0]),a.append("upload_preset","lzz18aot");let e=await fetch("https://api.cloudinary.com/v1_1/dhjapmqga/image/upload",{method:"POST",body:a});if(!e.ok)throw Error("Failed to upload image.");let o=await e.json();return{...t,tipImage:o.secure_url}}return t}));if(t.realContent=e,!(u?await fetch("/api/tip_api?id=".concat(a),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}):await fetch("/api/tip_api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw Error("Failed to submit form data.");window.location.href="/admin/tips/tips"}catch(t){console.error("Error:",t)}};(0,o.useEffect)(()=>{e||t.push("/login")},[e,t]);let y=async t=>{if(t.preventDefault(),j){alert("Invalid form. Cannot submit.");return}try{let t={...h},e=await Promise.all(t.realContent.map(async(t,e)=>{let a=new FormData,n=document.getElementById("Image-".concat(e));if(n&&n.files.length>0){a.append("file",n.files[0]),a.append("upload_preset","lzz18aot");let e=await fetch("https://api.cloudinary.com/v1_1/dhjapmqga/image/upload",{method:"POST",body:a});if(!e.ok)throw Error("Failed to upload image.");let o=await e.json();return{...t,tipImage:o.secure_url}}return t}));if(t.realContent=e,!(await fetch("/api/tip_api?id=".concat(a),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw Error("Network response was not ok");window.location.href="/admin/tips/tips"}catch(t){console.error("Error:",t)}},T=t=>{let{name:e,value:a}=t.target;if("tipsLink"===e)return/^(http|https):\/\/.+/.test(a)?(x(""),g(""),!0):(x("Invalid format. Cannot submit."),g("Invalid link format. Requires to start with: http:// or https://"),!1)};return(0,n.jsx)("div",{className:"".concat(s().formContainer," ").concat(s().formContainerTips),children:(0,n.jsxs)("form",{className:"".concat(s().form," ").concat(s().formTips),onSubmit:v,children:[(0,n.jsxs)("div",{className:s().inputGroup,children:[(0,n.jsx)("label",{children:"Tip Name"}),(0,n.jsx)("input",{required:!0,type:"text",name:"tipName",value:h.tipName,placeholder:u?h.tipName:"",onChange:t=>b({...h,tipName:t.target.value})})]}),(0,n.jsxs)("div",{className:s().inputGroup,children:[(0,n.jsx)("label",{children:"Tip Link"}),(0,n.jsx)("input",{required:!0,type:"text",name:"tipsLink",value:h.tipsLink,placeholder:u?h.tipsLink:"",onChange:t=>{T(t),b({...h,tipsLink:t.target.value})}}),f&&(0,n.jsx)("p",{className:"error",children:f})]}),!u&&m.map((t,e)=>(0,n.jsxs)("div",{className:s().Row,children:[(0,n.jsxs)("div",{className:"".concat(s().inputGroup," ").concat(s().organizerInput," "),children:[(0,n.jsx)("label",{children:"Content Name"}),(0,n.jsx)("input",{type:"text",name:"name",value:t.name,onChange:t=>C(e,t)})]}),(0,n.jsxs)("div",{className:"".concat(s().inputGroup," ").concat(s().organizerInput," ").concat(s().contentInput),children:[(0,n.jsx)("label",{children:"Content"}),(0,n.jsx)("input",{type:"text",name:"contents",value:t.contents,onChange:t=>C(e,t)})]}),(0,n.jsxs)("div",{className:"".concat(s().inputGroup,"  "),children:[(0,n.jsx)("label",{children:"Image"}),(0,n.jsx)("input",{id:"Image-".concat(e),type:"file",name:"tipImage",accept:".jpeg, .png, .jpg",onChange:t=>C(e,t)})]}),(0,n.jsxs)("div",{className:"".concat(s().inputGroup," ").concat(s().centered," "),children:[(0,n.jsx)("label",{className:s().hideLable,children:" a"}),(0,n.jsx)("button",{className:"".concat(c().btn," ").concat(s().btnTip," "),type:"button",onClick:()=>N(e),children:"Delete"})]})]},e)),u&&m.map((t,e)=>(0,n.jsxs)("div",{className:"".concat(s().Row," }"),children:[(0,n.jsxs)("div",{className:"".concat(s().inputGroup," ").concat(s().organizerInput),children:[(0,n.jsx)("label",{children:"Content Name"}),(0,n.jsx)("input",{type:"text",name:"name",value:t.name,onChange:t=>w(e,t)})]}),(0,n.jsxs)("div",{className:"".concat(s().inputGroup," ").concat(s().organizerInput," ").concat(s().contentInput),children:[(0,n.jsx)("label",{children:"Content"}),(0,n.jsx)("input",{type:"text",name:"contents",value:t.contents,onChange:t=>w(e,t)})]}),(0,n.jsxs)("div",{className:s().inputGroup,children:[(0,n.jsx)("label",{children:"Image"}),(0,n.jsx)("input",{id:"Image-".concat(e),type:"file",name:"tipImage",accept:".jpeg, .png, .jpg",onChange:t=>w(e,t)})]}),(0,n.jsxs)("div",{className:"".concat(s().inputGroup," ").concat(s().centered," "),children:[(0,n.jsx)("label",{className:s().hideLable,children:" a"}),(0,n.jsx)("button",{className:"".concat(c().btn," ").concat(s().btnTip),type:"button",onClick:()=>N(e),children:"Delete"})]})]},e)),(0,n.jsxs)("div",{className:c().btnBottomDiv,children:[(0,n.jsx)("button",{className:"".concat(c().btn," ").concat(c().btnBottom," "),type:"button",onClick:()=>{l(r+1),d([...m,{name:"",contents:"",tipImage:""}])},children:"Add more tip content"}),(0,n.jsx)("button",{className:"".concat(c().btn," ").concat(c().btnBottom),type:"submit",onClick:u?y:v,children:u?"Update":"Create"}),(0,n.jsx)("button",{className:"".concat(c().btn," ").concat(c().btnBottom," "),type:"button",onClick:()=>{window.location.href="/admin/tips/tips"},children:"Return"})]})]})})};m.hideLayout=!0,e.default=m},7148:function(t){t.exports={formContainer:"Admin_Form_formContainer__woS1p",formContainerTips:"Admin_Form_formContainerTips__EqLt9",userResetPasswordContainer:"Admin_Form_userResetPasswordContainer__8cHa0",formContainerAdminChangePassword:"Admin_Form_formContainerAdminChangePassword__2ZidI",form:"Admin_Form_form__TPPNs",formTips:"Admin_Form_formTips__LsRp0",inputGroup:"Admin_Form_inputGroup__tdFHl",inputGroupTips:"Admin_Form_inputGroupTips__zzKew",Row:"Admin_Form_Row__LVOvY",row:"Admin_Form_row__MxQDQ",organizerInput:"Admin_Form_organizerInput__0pcKt",hideLable:"Admin_Form_hideLable__CrPVN",btnTip:"Admin_Form_btnTip__7GRqP",contentInput:"Admin_Form_contentInput__L_npg",centered:"Admin_Form_centered__GuOUu",notificationMessage:"Admin_Form_notificationMessage__HpZle"}},1993:function(t){t.exports={divTable:"table_divTable__nZy3u",mainTable:"table_mainTable__2ozUS",tableHeading:"table_tableHeading__G1BNY",tableRow:"table_tableRow__OefgE",imageTable:"table_imageTable__8IOsJ",btnTableDiv:"table_btnTableDiv__TZLkB",btn:"table_btn__1oU_a",btnTable:"table_btnTable__M5Q8P",btnBottomDiv:"table_btnBottomDiv__9kcEX",btnBottom:"table_btnBottom__tziMg",btnForm:"table_btnForm__3wNV1"}},1163:function(t,e,a){t.exports=a(2937)}},function(t){t.O(0,[774,888,179],function(){return t(t.s=1585)}),_N_E=t.O()}]);